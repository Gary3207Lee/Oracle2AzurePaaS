# **Oracle2PostgreSQL Scenario Guide**

This document is based on [Migrate Oracle to Azure Database for PostgreSQL](https://learn.microsoft.com/en-us/azure/postgresql/migrate/how-to-migrate-from-oracle) and aditional guides / contents / links are in individual titles.
</br>

</br>

## **Typical Ora2PG Migration Architecture**

![02_01.ora2pg-migration-architecture](./Resources/Image/02_01.ora2pg-migration-architecture.png)
</br>

</br>

## **Prerequsites**

- Verify your source environment is supported.
- Download [Strawberry Perl](http://strawberryperl.com/)
- Download [Oracle Client](https://www.oracle.com/database/technologies/odac-downloads.html)
- Download [PostgreSQL Client](https://www.postgresql.org/download/)
- Download the latest version of [ora2pg](https://ora2pg.darold.net/).
- Have the latest version of the [DBD](https://www.cpan.org/modules/by-module/DBD/) module.
- [MAP Tool kit](https://go.microsoft.com/fwlink/?LinkID=316883)
- [Azure Data Studio](https://learn.microsoft.com/en-us/sql/azure-data-studio/download-azure-data-studio?view=sql-server-ver16)
- [Database Migration Assessment for Oracle Extention](https://learn.microsoft.com/en-us/sql/azure-data-studio/extensions/database-migration-assessment-for-oracle-extension?view=sql-server-ver16)

</br>

</br>

## **Ora2PG**

Ora2Pg is a free tool used to migrate an Oracle database to a PostgreSQL compatible schema. It connects your Oracle database, scans it automatically and extracts its structure or data, then generates SQL scripts that you can load into your PostgreSQL database.
</br>
Ora2Pg can be used for anything from reverse engineering Oracle database to huge enterprise database migration or simply replicating some Oracle data into a PostgreSQL database. It is really easy to use and doesn't require any Oracle database knowledge other than providing the parameters needed to connect to the Oracle database.
</br>

</br>

- [Installation Document](https://ora2pg.darold.net/documentation.html#INSTALLATION)
    - [Strawberry Perl](http://strawberryperl.com/)
    - [Oracle Client](https://www.oracle.com/database/technologies/odac-downloads.html)
    - [PostgreSQL Client](https://www.postgresql.org/download/)
    - [Ora2PG](https://github.com/darold/ora2pg/releases)
    - [DBD](https://www.cpan.org/modules/by-module/DBD/)
    </br>
- [Configuration Document](https://ora2pg.darold.net/documentation.html#CONFIGURATION)
</br>

</br>

## **Discover**

The goal of the discovery phase is to identify existing data sources and details about the features that are being used. This phase helps you better understand and plan for the migration. The process involves scanning the network to identify all your organization's Oracle instances together with the version and features in use.
</br>

- [Recommendations](https://learn.microsoft.com/en-us/azure/postgresql/migrate/how-to-migrate-from-oracle#recommendations)
- [Discover](https://learn.microsoft.com/en-us/azure/postgresql/migrate/how-to-migrate-from-oracle#discover)

- You can utilize **Microsoft Assessment and Planning Toolkit** to identify existing data sources and details about the features your organization is using. This process involves scanning the network to identify all your organization's Oracle instances, versions, and features. </br>
- To use the **MAP Toolkit** to perform an inventory scan, please refer to this [**guide document**](https://learn.microsoft.com/en-us/sql/sql-server/migrate/guides/oracle-to-sql-server?view=sql-server-ver16#discover).
</br>

</br>

## **Assessment**

After you inventory the Oracle databases, you'll have an idea of the database size and potential challenges. The next step is to run the assessment.
</br>

- Using [**Ora2PG**](https://learn.microsoft.com/en-us/azure/postgresql/migrate/how-to-migrate-from-oracle#assess)
- Using **Azure Data Studio** with [**Database Migration Assessment for Oracle extension (Preview)**](https://learn.microsoft.com/en-us/sql/azure-data-studio/extensions/database-migration-assessment-for-oracle-extension?view=sql-server-ver16)

</br>

</br>

## **Convert**

In this step of the migration, the Oracle code and DDL scripts are converted or translated to PostgreSQL. The ora2pg tool exports the Oracle objects in a PostgreSQL format automatically. Some of the generated objects can't be compiled in the PostgreSQL database without manual changes.
</br>

- Using [**Ora2PG**](https://learn.microsoft.com/en-us/azure/postgresql/migrate/how-to-migrate-from-oracle#assess)

</br>

### **Useful Tips & Guide**

- Oracle consider char(0) as a null value and PostgreSQL doesn't accept char(0) or '' value. You need to filter those value before the migration.
- Export data by using the COPY command instead of INSERT.
- Avoid exporting tables with their foreign keys (FKs), constraints, and indexes. These elements slow down the process of importing data into PostgreSQL.
- Create materialized views by using the no data clause. Then refresh the views later.
- If possible, use unique indexes in materialized views. These indexes can speed up the refresh when you use the syntax REFRESH MATERIALIZED VIEW CONCURRENTLY.
- Please refer to the [workaround guide](./Resources/Oracle%20to%20Azure%20Database%20for%20PostgreSQL%20Migration%20Workarounds.pdf) to compare Oracle and PostgreSQL.
- [SQLines References](https://www.sqlines.com/oracle-to-postgresql#sql-language-elements)

</br>

</br>

## **Migrate**

When you've made the necessary fixes, a stable build of the database is ready to deploy. Run the psql import commands, pointing to the files that contain the modified code. This task compiles the database objects against the PostgreSQL database and imports the data.
</br>

- Using [Ora2PG](https://learn.microsoft.com/en-us/azure/postgresql/migrate/how-to-migrate-from-oracle#compile-files)
- [Copy data from Oracle by using Azure Data Factory](https://learn.microsoft.com/en-us/azure/data-factory/connector-oracle?tabs=data-factory)
- [Incrementally load data from a source data store to a destination data store](https://learn.microsoft.com/en-us/azure/data-factory/tutorial-incremental-copy-overview)
- [ForEach Loop to CopyData and Capture Metadata in ControlTable - Part 1](https://techcommunity.microsoft.com/t5/fasttrack-for-azure/foreach-loop-to-copydata-and-capture-metadata-in-controltable/ba-p/3661559)
- [ForEach Loop to CopyData and Capture Metadata in ControlTable - Part 2](https://techcommunity.microsoft.com/t5/fasttrack-for-azure/foreach-loop-to-copydata-and-capture-metadata-in-controltable/ba-p/3661770)
- [ForEach Loop to CopyData and Capture Metadata in ControlTable - Part 3](https://techcommunity.microsoft.com/t5/fasttrack-for-azure/foreach-loop-to-copydata-and-capture-metadata-in-controltable/ba-p/3662436)
</br>

### **3rd Party Solutions**

- [Qlik(Attunity)](https://www.qlik.com/us/streaming-data/data-streaming-cdc)
- [SQLines](https://www.sqlines.com/oracle-to-postgresql)
- [Striim](https://www.striim.com/)
</br>

</br>

## **References**

- [Data Migration Whitepapers](https://github.com/microsoft/DataMigrationTeam/tree/master/Whitepapers)
- [Oracle to Azure Database for PostgreSQL Migration Cookbook](./Resources/Oracle%20to%20Azure%20Database%20for%20PostgreSQL%20Migration%20Cookbook.pdf)
- [Oracle to Azure Database for PostgreSQL Migration Guide](./Resources/Oracle%20to%20Azure%20Database%20for%20PostgreSQL%20Migration%20Guide.pdf)
- [Steps to Install ora2pg on Windows and Linux](./Resources/Steps%20to%20Install%20ora2pg%20on%20Windows%20and%20Linux.pdf)
- [ora2pg.conf](./Resources/ora2pg.conf.pdf)
- [Ora2PG Install](https://github.com/microsoft/OrcasNinjaTeam/tree/master/ora2pg-install)
</br>

</br>
